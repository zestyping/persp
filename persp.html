<style>
body { font-family: helvetica neue, sans-serif; font-size: 14px; margin: 18px; }
table th, table td { padding-right: 18px; }
.view { position: relative; }
.canvas { cursor: none; }
.cursor { position: absolute; cursor: none; }
.message { font-family: andale mono, courier new, monospace; font-size: 24px; }
th { text-align: left; font-weight: bold; padding-bottom: 6px; }
</style>

<table cellspacing=0 cellpadding=0>
  <tr>
    <th>Photo</th>
    <th>World</th>
  </tr>
  <tr>
    <td id="photo" class="view">
      <img id="photo-canvas" class="canvas" src="photo.jpg">
      <img id="photo-cursor" class="cursor" src="crosshairs.png">
    </td>
    <td id="world" class="view">
      <div id="world-canvas" class="canvas"></div>
      <img id="world-cursor" class="cursor" src="crosshairs.png">
    </td>
  </tr>
  <tr>
    <td><pre id="photo-status" class="message"></pre></td>
    <td><pre id="world-status" class="message"></pre></td>
  </tr>
</table>

<script src="jquery-1.5.1.min.js"></script>
<script>
var MARGIN = 12;
var PHOTO_WIDTH = 640;
var PHOTO_HEIGHT = 512;
var CROSSHAIRS_WIDTH = 27;
var CROSSHAIRS_HEIGHT = 27;

var photo = $('#photo')[0];
var photoCanvas = $('#photo-canvas')[0];
var photoCursor = $('#photo-cursor')[0];
var world = $('#world')[0];
var worldCanvas = $('#world-canvas')[0];
var worldCursor = $('#world-cursor')[0];

photoCanvas.style.width = PHOTO_WIDTH + 'px';
photoCanvas.style.height = PHOTO_HEIGHT + 'px';
worldCanvas.style.width = PHOTO_WIDTH + 'px';
worldCanvas.style.height = PHOTO_HEIGHT + 'px';

var photoCanvasLeft = 0;
var photoCanvasTop = 0;
for (var e = photoCanvas; e; e = e.offsetParent) {
  photoCanvasLeft += e.offsetLeft;
  photoCanvasTop += e.offsetTop;
}

function movePhotoCursor(x, y) {
  photoCursor.style.left = (photoCanvas.offsetLeft + x - (CROSSHAIRS_WIDTH - 1)/2) + 'px';
  photoCursor.style.top = (photoCanvas.offsetTop + y - (CROSSHAIRS_HEIGHT - 1)/2) + 'px';
  photoCursor.style.width = CROSSHAIRS_WIDTH + 'px';
  photoCursor.style.height = CROSSHAIRS_HEIGHT + 'px';
}

function hidePhotoCursor() {
  movePhotoCursor(-1000, -1000);
}

function photoToWorld(x, y) {
  return [x / PHOTO_WIDTH, y / PHOTO_HEIGHT];
}

function worldToPhoto(x, y) {
  return [x * PHOTO_WIDTH, y * PHOTO_HEIGHT];
}

photo.addEventListener('mousemove', function(event) {
  console.log(event);
  var x = event.pageX - photoCanvasLeft;
  var y = event.pageY - photoCanvasTop;
  if (x >= 0 && x < PHOTO_WIDTH && y >= 0 && y < PHOTO_HEIGHT) {
    $('#photo-status').text('x = ' + x + '\ny = ' + y);
    movePhotoCursor(x, y);
  } else {
    $('#photo-status').text('');
    hidePhotoCursor();
  }
});
</script>
